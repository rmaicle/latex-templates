\documentclass[
    $if(fontsize)$$fontsize$$else$10pt$endif$,
    $if(papersize)$$papersize$$else$letterpaper$endif$,
    titlepage,
    oneside,
    openright,
    $if(draft)$draft$else$final$endif$,
    article]{memoir}



% Recommended margin and binding offset
% https://tex.stackexchange.com/questions/249190/
\usepackage[top=1.0in, bottom=1.0in, left=1.0in, right=1.0in,
    footskip=0.4in,
    $if(softcopy)$bindingoffset=0.0in$else$bindingoffset=0.5in$endif$,
    showframe=$if(showframe)$$showframe$$else$false$endif$]
    {geometry}

\usepackage{ifxetex,ifluatex}
\usepackage{ifpdf}
\usepackage{ifdraft}
\usepackage{titlesec}
\usepackage{ragged2e}
% Package fixltx2e is not required with releases after 2015.
% All fixes are now in the LaTeX kernel.
% See the latexrelease package for details.

% Subscripts
% Using \textsubscript in a section heading, hyperref will cause an
% error. To circumvent this, use \texorpdfstring.
% https://tex.stackexchange.com/questions/1013/

% Must be loaded here. Otherwise an 'Option class for package xcolor'
% error occurs.
% TODO: Determine which option it clashes with.
\usepackage[svgnames]{xcolor}
\definecolor{GrayBackground}{RGB}{250,250,250}
% Darker by 10%
\definecolor{GrayBackgroundDarkerTen}{RGB}{225,225,225}
% Darker by 20%
\definecolor{GrayBackgroundDarkerTwenty}{RGB}{199,199,199}



% Fonts and Encoding
% ------------------

% If system fonts are going to be used, use fontspec.
\ifxetex
    \usepackage{fontspec}
    %\defaultfontfeatures{Ligatures=TeX} % To support LaTeX quoting style
    %\setromanfont{Noto Serif}
    %\setmainfont{}
\fi

% Chapter 9: Fonts, LaTeX Wikibooks, June 2016
% If you do not have a specific font encoding issue (e.g. writing English
% only), there is no need for T1. Sticking to the default font encoding is
% not a problem.
%
% To be able to use other TeX fonts, make sure T1 encoding is used.
\usepackage[T1]{fontenc}
% Must load ucs before inputenc
\usepackage{ucs}
\usepackage[utf8x]{inputenc}

% Provides euro and other symbols
% https://en.wikibooks.org/wiki/LaTeX/Special_Characters
\usepackage{textcomp}

\ifpdf
\usepackage[
    protrusion=true,
    expansion=true,
    kerning=false]{microtype}
\fi

\usepackage{pifont}

% Serif fonts
% -----------
\usepackage{charter}                        % {bch} *****
% Used only to display sample text
%\usepackage{lmodern}
\usepackage{times}                          % {ptm}
%\usepackage{palatino}                       % {ppl}
%\usepackage{noto}
%\usepackage{bookman}                        % {pbk}
%\usepackage{concrete}                       % beton.sty not found
%\usepackage{pslatex}
%\usepackage{newcent}                        % {pnc}
%\usepackage{kpfonts}
%\usepackage{utopia}                         % {put}
%\usepackage{pandora}                        % error on roman font

% Sans-serif fonts
% ----------------
\usepackage[scaled=0.92]{helvet}            % {phv}
% Used only to display sample text
% \usepackage[scaled=0.85]{berasans}          % {fvs}
%\usepackage{cmbright}
%\usepackage{kurier}
%\usepackage{sourcesanspro}

% Typewriter fonts
% ----------------
% Latin Modern Typewriter font
% Make the light series be the default.
% From: An exploration of the Latin Modern fonts
%       by Will Robertson
%       The PracTEX Journal
%       TPJ2006No01, 2006-02-01
%       http://dw.tug.org/pracjourn/2006-1/robertson/robertson.pdf
\usepackage{lmodern}                        % {lmtt}
\DeclareFontFamily{T1}{lmtt}{}
\DeclareFontShape{T1}{lmtt}{m}{n}{<-> ec-lmtl10}{}
\DeclareFontShape{T1}{lmtt}{m}{\itdefault}{<-> ec-lmtlo10}{}
\DeclareFontShape{T1}{lmtt}{\bfdefault}{n}{<-> ec-lmtk10}{}
\DeclareFontShape{T1}{lmtt}{\bfdefault}{\itdefault}{<-> ec-lmtko10}{}
\usepackage[scaled=0.855]{beramono}          % {fvm}

% Make default fonts
% ------------------
\renewcommand*\rmdefault{bch}               % Charter - I don't like how the italic looks'
%\renewcommand*\rmdefault{ppl}               % Palatino
%\renewcommand*\rmdefault{put}               % Utopia - Taller and a bit wider than Bitstream Charter'
%\renewcommand*\rmdefault{ptm}               % Times
%\renewcommand*\rmdefault{pbk}               % Bookman
%\renewcommand*\rmdefault{pnc}               % New Centurey Schoolbook

%\renewcommand*\sfdefault{lmss}              % Latin modern sans serif
%\renewcommand*\sfdefault{cmss}
\renewcommand*\sfdefault{phv}

%\renewcommand*\ttdefault{zi4}               % Inconsolata *****
%\renewcommand*\ttdefault{fvm}               % Bera mono
%\renewcommand*\ttdefault{cmtt}              % Computer Modern Typewriter
%\renewcommand*\ttdefault{lmtt}              % Latin Modern Typewriter

% Change the default font
% https://stackoverflow.com/questions/877597/
% \renewcommand{\familydefault}{\sfdefault}



% Hyperlinks
% ==========

% When using hyperref with footmisc, the footmisc documentation recommends
% turning hyperlinks from footnote marks to the corresponding footnote body.
% Package footmisc version 5.5b dated June 6, 2011.
\usepackage[colorlinks=true,hyperfootnotes=false]{hyperref}
\hypersetup{
    $if(title-meta)$
        pdftitle={$title-meta$},
    $endif$
    $if(author-meta)$
        pdfauthor={$author-meta$},
    $endif$
    $if(keywords)$
        pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
    $endif$
    $if(colorlinks)$
        colorlinks=true,
        linkcolor=$if(linkcolor)$$linkcolor$$else$Maroon$endif$,
        citecolor=$if(citecolor)$$citecolor$$else$Blue$endif$,
        urlcolor=$if(urlcolor)$$urlcolor$$else$Blue$endif$,
    $else$
        % Remove the border placed around a URL.
        % Ref: LaTeX, Wikibooks, June 18, 2016.
        pdfborder={0 0 0},
    $endif$
    bookmarks=true,
    pdftoolbar=true,            % show Acrobat’s toolbar?
    pdfmenubar=true,            % show Acrobat’s menu?
    pdfstartview={null null 100},
    breaklinks=true
}
% Don't use monospace font for URLs.
% Note: The hyperref package shows the URL using monospace font.
\urlstyle{same}



% Tables
% ======

\usepackage{longtable}
\usepackage{booktabs}



% Fancy Verbatim
% fancyvrb is automatically loaded here after \hypersetup.
% DO NOT load the package manually
% ================================

%$if(highlighting-macros)$
%    $highlighting-macros$
%$endif$



% Graphics
% ========

\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}



% Source Code Listings
% ====================
% When --listings argument is passed to pandoc, all code blocks will be
% wrapped within the listings environment.

\newcommand\TRMFontSize{\fontsize{9}{9}\selectfont}
\newcommand\LSTFontSize{\fontsize{9}{9}\selectfont}

\ifpdf
\newcommand*\CMDb{\usefont{T1}{lmtt}{b}{n}\TRMFontSize\selectfont\SetTracking{encoding=*}{-12}\lsstyle}
\newcommand*\OUTb{\usefont{T1}{lmtt}{b}{n}\TRMFontSize\selectfont\SetTracking{encoding=*}{-9}\lsstyle}
\newcommand*\LSTb{\usefont{T1}{fvm}{b}{n}\LSTFontSize\selectfont\SetTracking{encoding=*}{-2}\lsstyle}

\newcommand*\CMDi{\usefont{T1}{lmtt}{m}{it}\TRMFontSize\selectfont\SetTracking{encoding=*}{-18}\lsstyle}
\newcommand*\OUTi{\usefont{T1}{lmtt}{m}{it}\TRMFontSize\selectfont\SetTracking{encoding=*}{-9}\lsstyle}
\newcommand*\LSTi{\usefont{T1}{fvm}{m}{it}\LSTFontSize\selectfont\SetTracking{encoding=*}{-2}\lsstyle}

\newcommand*\CMDe{\usefont{T1}{lmtt}{b}{it}\TRMFontSize\selectfont\SetTracking{encoding=*}{-18}\lsstyle}
\newcommand*\OUTe{\usefont{T1}{lmtt}{b}{it}\TRMFontSize\selectfont\SetTracking{encoding=*}{-9}\lsstyle}
\newcommand*\LSTe{\usefont{T1}{fvm}{b}{it}\LSTFontSize\selectfont\SetTracking{encoding=*}{-2}\lsstyle}
\else
\newcommand*\CMDb{\usefont{T1}{lmtt}{b}{n}\TRMFontSize\selectfont}
\newcommand*\OUTb{\usefont{T1}{lmtt}{b}{n}\TRMFontSize\selectfont}
\newcommand*\LSTb{\usefont{T1}{fvm}{b}{n}\LSTFontSize\selectfont}

\newcommand*\CMDi{\usefont{T1}{lmtt}{m}{it}\TRMFontSize\selectfont}
\newcommand*\OUTi{\usefont{T1}{lmtt}{m}{it}\TRMFontSize\selectfont}
\newcommand*\LSTi{\usefont{T1}{fvm}{m}{it}\LSTFontSize\selectfont}

\newcommand*\CMDe{\usefont{T1}{lmtt}{b}{it}\TRMFontSize\selectfont}
\newcommand*\OUTe{\usefont{T1}{lmtt}{b}{it}\TRMFontSize\selectfont}
\newcommand*\LSTe{\usefont{T1}{fvm}{b}{it}\LSTFontSize\selectfont}
\fi

$if(listings)$
    \usepackage{listings}
    % Package listings require fancyvrb right now.
    \usepackage{fancyvrb}

    % Shrink the code listings
    % Can only be used if pdf engine is pdflatex.
    % Ref: Shrinking monospace style for listings package
    %      https://tex.stackexchange.com/questions/33020/
    %
    % Bera Mono
    % fontsize=10pt
    % basewidth=0.6em
    \ifpdf
        \newcommand*\BeraMonofont{%
            \usefont{T1}{fvm}{m}{n}%
            \LSTFontSize%
            \selectfont%
            \SetTracking{encoding=*}{-60}%
            \lsstyle}
    \else
        \newcommand*\BeraMonofont{%
            \usefont{T1}{fvm}{m}{n}%
            \LSTFontSize%
            \selectfont}
    \fi
    % Latin Modern Typewriter (lmtt)
    % fontsize=10pt
    % basewidth=0.5em
    % -----
    % At 0.5em basewidth, it is 2-character short to fit the 80
    % characters within the page textwidth. At 0.49em basewidth,
    % it fits perfect though the numbers appear a bit too closer
    % to each other.
    %
    % If you prefer a slashed zero, this is not it.
    \ifpdf
        \newcommand*\Terminalfont{%
            \usefont{T1}{lmtt}{m}{n}%
            \LSTFontSize%
            \selectfont%
            \SetTracking{encoding=*}{-9}%
            \lsstyle}
    \else
        \newcommand*\Terminalfont{%
            \usefont{T1}{lmtt}{m}{n}%
            \LSTFontSize%
            \selectfont}
    \fi

    % Problem with hyphen being rendered too wide
    % https://tex.stackexchange.com/questions/33185/
    \lstdefinestyle{Common}{
        literate={-}{-}1
    }

    \lstdefinestyle{TerminalCommon}{
        style=Common,
        basicstyle=\Terminalfont,
        keywordstyle=\Terminalfont,
        stringstyle=\Terminalfont,
        commentstyle=\Terminalfont,
        numberstyle=\Terminalfont\footnotesize\color{DimGray},
        basewidth=0.5em,
        lineskip=0.5pt
    }

    \lstdefinestyle{ListingCommon}{
        style=Common,
        basicstyle=\BeraMonofont,
        $if(softcopy)$
            keywordstyle=\BeraMonofont\color{NavyBlue},
            stringstyle=\BeraMonofont\color{Brown},
            commentstyle=\BeraMonofont\color{Green},
        $else$
            keywordstyle=\BeraMonofont,
            stringstyle=\BeraMonofont,
            commentstyle=\BeraMonofont,
        $endif$
        numberstyle=\BeraMonofont\footnotesize\color{DimGray},
        basewidth=0.6em,
        lineskip=1pt
    }

    \lstdefinestyle{command}{
        style=TerminalCommon
    }

    \lstdefinestyle{output}{
        style=TerminalCommon
    }

    \lstdefinestyle{syntax}{
        style=ListingCommon
    }

    \lstdefinestyle{listing}{
        style=ListingCommon
    }

    \lstdefinestyle{lines}{
        $if(softcopy)$
            aboveskip=0.5em,
        $else$
            aboveskip=0.3em,
        $endif$
        belowskip=0.4em,
        frameround=fttf,
        $if(softcopy)$
            % Adds to the left and right margins
            framexleftmargin=7pt,
            framexrightmargin=0pt,
        $else$
            framexleftmargin=0pt,
            framexrightmargin=0pt,
        $endif$
        frame=lines,
        framerule=0.1pt,
        rulecolor=\color{DimGray}
    }


    \lstset{
        fancyvrb=true,
        style=TerminalCommon,
        fontadjust=true,
        extendedchars=false,
        columns=[c]fixed,
        breakatwhitespace=true,
        keepspaces=true,
        showstringspaces=false,
        numbersep=10pt,
        $if(softcopy)$
            aboveskip=1em,
            belowskip=0.4em,
        $else$
            aboveskip=0.5em,
            belowskip=0em,
        $endif$
        % Memoir class \parindent length:
        %   10pt font size 15pt length
        %   11pt font size 17pt length
        %   12pt font size 1.5em length based on Computer Modern font
        % In two-column mode \parindent is always 1em based on
        % Computer Modern font. More info at the reference link:
        %   https://tex.stackexchange.com/questions/50138/
        %
        % The following value merely aligns the code listing (with
        % line numbers) to the left with the text body.
        % xleftmargin=0.28in
        xleftmargin=24pt,       % 3-digit line numbers
        xleftmargin=27pt,       % 4-digit line numbers
        frame=none,
        escapechar=@
    }

    % Frame and background
    $if(softcopy)$
        \newlength{\linenumwidth} \setlength{\linenumwidth}{5em}
        \lstset{
            frame=single,
            frameround=tttt,
            framesep=2.5pt,
            framerule=0.1pt,
            framextopmargin=3.5pt,
            framexbottommargin=2.5pt,
            framexleftmargin=5pt,
            framexrightmargin=-2pt,
            rulecolor=\color{Gainsboro},
            rulecolor=\color{GrayBackgroundDarkerTwenty},
            rulesepcolor=\color{GrayBackground},
            backgroundcolor=\color{GrayBackground}
        }
    $endif$

    % https://github.com/jgm/pandoc/issues/4716
    \newcommand{\passthrough}[1]{#1}

    % Make lstinline use a different font size lstlistings or lstinputlisting
    % To use a different font and font size use the following:
    % \lst@AddToHook{TextStyle}{\let\lst@basicstyle\normalsize\fontfamily{zi4}\selectfont}
    % Ref: https://latex.org/forum/viewtopic.php?t=2072
    \makeatletter
    \lst@AddToHook{TextStyle}{\let\lst@basicstyle\normalsize\fontfamily{fvm}\mdseries\selectfont}
    \makeatother

$else$

    % When --listings argument is not passed to pandoc, we change all
    % code block font sizes.
    % How to set font size for all verbatims in Beamer presentation?
    % https://tex.stackexchange.com/a/133443
    %
    % \makeatletter
    % \def\verbatim@font{\small\ttfamily}
    % \makeatother
    %
    % Change verbatim environment font
    % 15.3 Verbatim (memoir class documentation)
    %\setverbatimfont{\ttfamily\small}
    \setverbatimfont{\ttfamily\normalsize}
    % Because fancyvrb package was loaded automatically and the following environment was
    % defined when there is no --listing argument to pandoc, we "re-define" the environment
    % to change the font size.
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{
        commandchars=\\\{\},
        xleftmargin=6.7mm,
        xrightmargin=0mm,
        numbersep=8pt,
        %fontsize=\small,
        fontsize=\normalsize,
        baselinestretch=1.0,
        showstringspaces=false,
    }
        % Disable: not for production use
        %frame=single,
        %rulecolor=\color{LightGray},
    %}

    % "Re-define theFancyVerbLine to use a different font and size.
    % See the fancyvrb package documentation for the original definition."
    \def\theFancyVerbLine{\color{gray}\ttfamily\small\arabic{FancyVerbLine}}
    \renewcommand*{\PreprocessorTok}[1]    {\textcolor{MediumVioletRed}{#1}}
    \renewcommand*{\CommentTok}[1]         {\textcolor{DarkGreen}{#1}}
    \renewcommand*{\StringTok}[1]          {\textcolor{SaddleBrown}{#1}}
    \renewcommand*{\KeywordTok}[1]         {\textcolor{DarkBlue}{#1}}
    \renewcommand*{\DataTypeTok}[1]        {\textcolor{Blue}{#1}}
    \renewcommand*{\ControlFlowTok}[1]     {\textcolor{OrangeRed}{#1}}
    \renewcommand*{\DecValTok}[1]          {\textcolor{Black}{#1}}

    %\renewcommand*{\KeywordTok}[1]         {\textcolor[rgb]{0.25,0.44,0.63}{#1}}
    %\renewcommand*{\DataTypeTok}[1]        {\textcolor[rgb]{0.56,0.13,0.00}{#1}}
    %\renewcommand*{\DecValTok}[1]          {\textcolor[rgb]{0.25,0.63,0.44}{#1}}
    %\renewcommand*{\BaseNTok}[1]           {\textcolor[rgb]{0.25,0.63,0.44}{#1}}
    %\renewcommand*{\FloatTok}[1]           {\textcolor[rgb]{0.25,0.63,0.44}{#1}}
    %\renewcommand*{\ConstantTok}[1]        {\textcolor[rgb]{0.53,0.00,0.00}{#1}}
    %\renewcommand*{\CharTok}[1]            {\textcolor[rgb]{0.25,0.44,0.63}{#1}}
    %\renewcommand*{\SpecialCharTok}[1]     {\textcolor[rgb]{0.25,0.44,0.63}{#1}}
    %\renewcommand*{\StringTok}[1]          {\textcolor[rgb]{0.73,0.40,0.53}{#1}}
    %\renewcommand*{\VerbatimStringTok}[1]  {\textcolor[rgb]{0.25,0.44,0.63}{#1}}
    %\renewcommand*{\SpecialStringTok}[1]   {\textcolor[rgb]{0.73,0.40,0.53}{#1}}
    %\renewcommand*{\ImportTok}[1]          {#1}
    %\renewcommand*{\CommentTok}[1]         {\textcolor[rgb]{0.38,0.63,0.69}{#1}}
    %\renewcommand*{\DocumentationTok}[1]   {\textcolor[rgb]{0.73,0.13,0.13}{#1}}
    %\renewcommand*{\AnnotationTok}[1]      {\textcolor[rgb]{0.38,0.63,0.69}{#1}}
    %\renewcommand*{\CommentVarTok}[1]      {\textcolor[rgb]{0.38,0.63,0.69}{#1}}
    %\renewcommand*{\OtherTok}[1]           {\textcolor[rgb]{0.00,0.44,0.13}{#1}}
    %\renewcommand*{\FunctionTok}[1]        {\textcolor[rgb]{0.02,0.16,0.49}{#1}}
    %\renewcommand*{\VariableTok}[1]        {\textcolor[rgb]{0.10,0.09,0.49}{#1}}
    %\renewcommand*{\ControlFlowTok}[1]     {\textcolor[rgb]{0.00,0.44,0.13}{#1}}
    %\renewcommand*{\OperatorTok}[1]        {\textcolor[rgb]{0.40,0.40,0.40}{#1}}
    %\renewcommand*{\BuiltInTok}[1]         {#1}
    %\renewcommand*{\ExtensionTok}[1]       {#1}
    %\renewcommand*{\PreprocessorTok}[1]    {\textcolor[rgb]{0.74,0.48,0.00}{#1}}
    %\renewcommand*{\AttributeTok}[1]       {\textcolor[rgb]{0.49,0.56,0.16}{#1}}
    %\renewcommand*{\RegionMarkerTok}[1]    {#1}
    %\renewcommand*{\InformationTok}[1]     {\textcolor[rgb]{0.38,0.63,0.69}{#1}}
    %\renewcommand*{\WarningTok}[1]         {\textcolor[rgb]{0.38,0.63,0.69}{#1}}
    %\renewcommand*{\AlertTok}[1]           {\textcolor[rgb]{1.00,0.00,0.00}{#1}}
    %\renewcommand*{\ErrorTok}[1]           {\textcolor[rgb]{1.00,0.00,0.00}{#1}}
    %\renewcommand*{\NormalTok}[1]          {#1}
$endif$



% Caption
% =======
% Formatting captions and subcaptions in LaTeX
% http://www.peteryu.ca/tutorials/publishing/latex_captions

\usepackage[
    margin=10pt,
    font=small,
    labelfont=bf,
    labelsep=endash]{caption}

\DeclareCaptionLabelFormat{listing}{\textbf{\faCode}\enskip #1\space #2}
\DeclareCaptionLabelSeparator{extraspace}{\space\space\space}

$if(softcopy)$
    \DeclareCaptionFormat{listing}{\colorbox{GrayBackgroundDarkerTen}{\parbox{0.9448\textwidth}{#1#2#3}}}
    \captionsetup[lstlisting]{
        format=listing,
        labelsep=extraspace,
        margin=19.95pt,
        skip=4pt,
    }
$else$
    \DeclareCaptionFormat{listing}{#1#2#3}
    \captionsetup[lstlisting]{
        format=listing,
        singlelinecheck=false,
        indention=24pt,
        labelsep=extraspace,
        margin=27pt,
        skip=5pt
    }
$endif$



% Footnotes
% =========

\usepackage[perpage,multiple,hang]{footmisc}
% Set vertical space between bottom of page text and start of footnote.
\setfootins{8mm plus 4mm minus 2mm}{8mm plus 4mm minus 2mm}
% Redefine footnote rule
% Set the line length to 2.5in with 0.03pt thickness. The vertical space
% between the rule and the first footnote entry is 0.5em.
\renewcommand{\footnoterule}{\noindent\rule{2.5in}{0.03pt}\vspace{0.5em}}
% Vertical space between paragraphs in a single footnote
%\renewcommand{\hangfootparskip}{0.0\baselineskip}
\renewcommand{\hangfootparskip}{0.5em}
% Change the vertical space between footnote items.
% If value is equal or small than the body text font size, then it does not
% seem to have an effect.
%\renewcommand{\footnotesep}{11pt}
\renewcommand{\footnotesep}{1.25em}
% Change the font size of the footnote number in the footnote area.
% https://latex.org/forum/viewtopic.php?t=8095
\renewcommand*\thefootnote{\footnotesize\arabic{footnote}}
% Change footnote text font size other than footnotesize
\renewcommand{\footnotesize}{\small}



% Other Packages
% ==============

\usepackage{makeidx}

$if(lang)$
    \ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
        \usepackage[shorthands=off,$for(babel-otherlangs)$$babel-otherlangs$,$endfor$main=$babel-lang$]{babel}
    $if(babel-newcommands)$
        $babel-newcommands$
    $endif$
    \else
        % Load polyglossia as late as possible as it *could* call bidi if
        % RTL lang (e.g. Hebrew or Arabic)
        \usepackage{polyglossia}
        \setmainlanguage[$polyglossia-lang.options$]{$polyglossia-lang.name$}
        $for(polyglossia-otherlangs)$
            \setotherlanguage[$polyglossia-otherlangs.options$]{$polyglossia-otherlangs.name$}
        $endfor$
    \fi
$endif$

% Base direction of the document, either `rtl` (right-to-left) or `ltr`
% (left-to-right). Pandoc: When using LaTeX for bidirectional documents, only
% the `xelatex` engine is fully supported (use `--latex-engine=xelatex`).
$if(dir)$
    \ifxetex
        % load bidi as late as possible as it modifies e.g. graphicx
        $if(latex-dir-rtl)$
            \usepackage[RTLdocument]{bidi}
        $else$
            \usepackage{bidi}
        $endif$
    \fi
    \ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
        \TeXXeTstate=1
        \newcommand{\RL}[1]{\beginR #1\endR}
        \newcommand{\LR}[1]{\beginL #1\endL}
        \newenvironment{RTL}{\beginR}{\endR}
        \newenvironment{LTR}{\beginL}{\endL}
    \fi
$endif$

% Using memoir class with fancyhdr may get compilation errors because both
% define the \footruleskip command when loading. To avoid the error, the
% command needs to be 'undefined' before fancyhdr is loaded but after memoir
% has been loaded.
% Ref: fancyhdr and memoir
%      http://tex.stackexchange.com/questions/37868/ddg#37880
\let\footruleskip\undefined
\usepackage{fancyhdr}

\usepackage[nopar]{lipsum}

% Use upquote if available, for straight quotes in verbatim environments.
% Must be loaded after other fonts.
\usepackage{upquote}

% Allow verbatim texts in footnotes
% Error: Undefined control sequence
% \VerbatimFootnotes



% Spacing
% =======

% Options: singlespacing, onehalfspacing, doublespacing
%
% For the need of a different stretching factor, the spacing environment is
% provided. It may be used like the following:
%
% \begin{spacing}{2.4}
% This text is stretched by a factor of 2.4.
% \end{spacing}
\usepackage{setspace}
% Change the \baselineskip without changing the font size.
\linespread{1.0}

% Strikeout a section of text with a horizontal line
\usepackage[normalem]{ulem}
% Avoid problems with \sout in headers with hyperref:
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}



% Settings
% ========



% Paragraph
% -----------------------------------------------------------------------------
% No indention
\setlength{\parindent}{0em}
% Vertical spacing between paragraphs
\setlength{\parskip}{0.5em}
% Prevent overfull lines
% https://tex.stackexchange.com/questions/241343/
\setlength{\emergencystretch}{3em}

% Sentance
% -----------------------------------------------------------------------------
% Traditional typography requires a larger space to indicate the end of a
% sentence. Following along the same logic, TEX puts more space after an
% exclamation point (!), and a question mark (?). However, this tradition
% is obsolete as this extra space is disturbing. So you should almost always
% execute \frenchspacing just before the beginning of every document,
% instructing TEX to treat commas and periods in the same way.
% (Latex Manual 8.6)
\frenchspacing

% Lists
% -----------------------------------------------------------------------------
% Make lists tight (less vertical space between items).
\providecommand{\tightlist}{%
    \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}
}

% Change list bullet characters
%\renewcommand{\labelitemi}{\ding{42}}
%\renewcommand{\labelitemii}{\ding{43}}
%\renewcommand{\labelitemiii}{\ding{44}}
%\renewcommand{\labelitemiv}{\ding{45}}

% Quotes
% -----------------------------------------------------------------------------
% Italicize text in quote environments
% The original code here was taken from memoir.cls in
% /usr/share/texmf-dist/tex/latex/memoir/
\renewenvironment*{quote}%
                  {\list{}{\rightmargin\leftmargin}%
                   \itshape\item[]}%
                  {\endlist}

% Figure placement
% -----------------------------------------------------------------------------
% The [htbp] controls where the table or figure is placed.
% Tables and figures do not need to go where you put them in
% the text. L A TEX moves them around to prevent large areas of
% white space from appearing in your paper.
%
% Each letter corresponds to a place where the table or figure
% should go:
%     b (Bottom)   Place the table at the bottom of the current page.
%     h (Here)     Place the table at the spot where the table environment
%                  appears in the text
%     p (Page)     Place the table at the top of the next page.
%     t (Top)      Place the table at the top of the current page.
%
% The first letter inside brackets has highest priority. In the example on the
% previous page, if L A TEX couldn’t put the table or figure "here", it tried
% to put it at the top of the current page, then on the bottom of the current
% page, then at the top of the next page.
% ---
% Ref: Figures and Tables in a LATEX Document
%      http://web.mit.edu/molly/Public/rsi2006/figtab.pdf
%
% Set default figure placement to htbp
\makeatletter
%
%\def\fps@figure{htbp}
%
% Prevent text from creeping between figures
%
% In the above example, text would be written underneath the floats if one
% uses the [!htb] float specifier. \clearpage flushes all pending % floats,
% setting them on their own pages, before starting the new sectional content.
% ---
% Ref: How to prevent text from creeping in between figures and tables
%      https://stackoverflow.com/a/23166245
%\def\fps@figure{!hbp}
\def\fps@figure{!h}
\makeatother

% Table of contents
% -----------------------------------------------------------------------------
\settocdepth{subsection}
\renewcommand{\cftchapterfont}{\large\bfseries}
\renewcommand{\cftsectionfont}{\large}
\renewcommand{\cftsubsectionfont}{\large}
\setlength{\cftsectionindent}{2.1em}
\setlength{\cftsubsectionindent}{5.6em}
\setlength{\cftchapternumwidth}{2.0em}
\setlength{\cftsectionnumwidth}{3.5em}
\setlength{\cftsubsectionnumwidth}{4.9em}
\setlength{\cftbeforechapterskip}{1.0em}
\setlength{\cftbeforesectionskip}{0.2em}
\setlength{\cftbeforesubsectionskip}{0.2em}
% Narrower
\setlength{\cftsubsectionindent}{4.7em}
\setlength{\cftsectionnumwidth}{2.5em}
\setlength{\cftsubsectionnumwidth}{3.5em}

% Chapter style
% -----------------------------------------------------------------------------
% Ref: How do fonts work in LaTeX?
%      https://tex.stackexchange.com/questions/338049/
\makechapterstyle{rmsimple}{
    \setlength{\beforechapskip}{1ex}
    \setlength{\afterchapskip}{1ex}
    \renewcommand{\printchaptername}{}
    \renewcommand{\chapternamenum}{}
    \renewcommand*{\printchapternum}{%
        \ifanappendix
            \chapnumfont \appendixname\space\thechapter\\%
        \else%
            \chapnumfont \thechapter\space\space\space\space%
        \fi%
    }
    \renewcommand*{\chapnumfont}{\fontsize{14pt}{16.8pt}\usefont{T1}{bch}{b}{n}}
    \renewcommand*{\chaptitlefont}{\fontsize{14pt}{16.8pt}\usefont{T1}{bch}{b}{n}}
    % The following commands concatenate the chapter number and chapter title
    \renewcommand*{\printchaptertitle}[1]{\chaptitlefont ##1}
    \renewcommand{\afterchapternum}{}

    % Note on using \nopagebreak instead of \nobreak
    % https://tex.stackexchange.com/questions/94217
    % Using 2pt just because the chapter title uses 2pt font size
    % bigger than the section title
    \renewcommand\afterchaptertitle{\par\nopagebreak\vspace{2pt}}
}

\chapterstyle{rmsimple}
\setsecheadstyle{\fontsize{13pt}{15.6pt}\usefont{T1}{bch}{b}{n}}
\setsubsecheadstyle{\fontsize{12pt}{14.4pt}\usefont{T1}{bch}{b}{n}}
\setsubsubsecheadstyle{\fontsize{11pt}{13.2pt}\usefont{T1}{bch}{b}{n}}
\titleformat{\paragraph}[block]{\fontsize{10pt}{12pt}\usefont{T1}{bch}{b}{n}}{\theparagraph}{1em}{}
\titleformat{\subparagraph}[block]{\fontsize{10pt}{12pt}\usefont{T1}{bch}{b}{it}}{}{0em}{}

\titlespacing{\section}{0pt}{1ex}{1ex}
\titlespacing{\subsection}{0pt}{1ex}{1ex}
\titlespacing{\subsubsection}{0pt}{1ex}{1ex}
\titlespacing{\paragraph}{0pt}{1ex}{1ex}
\titlespacing{\subparagraph}{0pt}{1ex}{1ex}

\setsecnumdepth{subparagraph}



%\makeindex



% =============================================================================
% Begin document
% =============================================================================



\begin{document}

% Title uses titlex in YAML matter in markdown file.
%
% The \usefont usage was from Fonts and Encoding chapter of the
% The LaTeX companion, 2nd Ed, 2004, p. 371.
% -----
$if(title)$
    \ifpdf
        \pdfbookmark{Title Page}{$title$}
    \fi
    \newlength{\centeroffset}
    \thispagestyle{empty}
    \vspace*{1.5in}
    \begin{flushleft}
        {
            {\fontsize{20pt}{24pt}\usefont{T1}{ptm}{b}{n}$title$}
            $if(subtitle)$
                {\\\fontsize{18pt}{21.6pt}\usefont{T1}{ptm}{m}{n}$subtitle$}
            $endif$
        }
        % The vertical space below the rule is the same height
        % as the subtitle font size
        \noindent\rule[-1.2pt]{\textwidth}{0.1pt}

        $if(version)$
            {\fontsize{12pt}{14.4pt}
                \usefont{T1}{ptm}{m}{n}
                % Add 'Draft' text on document version number
                % if the document class option 'draft' is specified
                \ifoptiondraft{Draft}{}\space $version$\\[0.05in]
            }
        $endif$
        {\fontsize{12pt}{14.4pt}\usefont{T1}{ptm}{m}{n}$date$}\\[0.05in]

        % $if(client)$
        %     {\fontsize{14pt}{22pt}\usefont{T1}{ptm}{b}{n}$client$}
        % $endif$

        \vspace*{2.5in}
        $for(author)$
            $if(author.name)$
                {\fontsize{12pt}{14.4pt}\usefont{T1}{ptm}{b}{n}$author.name$}
                $if(author.email)$
                    {\\[0.05in]\fontsize{12pt}{14.4pt}\usefont{T1}{ptm}{m}{n}$author.email$}
                $endif$
            $endif$
        $endfor$

        % Add a vertical fill to push down all items to the bottom page.
        % https://latex.org/forum/viewtopic.php?t=13428
        \vspace*{\fill}
        $if(distribution)$
            {\fontsize{11pt}{13.2pt}\usefont{T1}{ptm}{m}{n}$distribution$}
        $endif$
    \end{flushleft}
$endif$

\frontmatter
% Half title page
%\copyright
% Dedication page
% Other preliminaries

%$for(include-before)$
%$include-before$
%$endfor$

%
% Copyright
%
\thispagestyle{empty}
\begin{flushleft}
    {\bfseries $title$}
    $if(subtitle)$
        {\\\itshape $subtitle$}
    $endif$
    $if(version)$
        \normalsize \ifoptiondraft{Draft}{}\space $version$
    $endif$
    \hfill\newline
    $if(author)$
        % For multiple authors
        % \normalsize by\\
        % $for(author)$
        %     \normalsize $author.name$\\
        % $endfor$

        % For single author
        \normalsize by $for(author)$$author.name$$endfor$
        \vspace*{1em}
    $endif$

    \vspace*{1.5em}

    $if(cc_license_image)$
        \includegraphics[keepaspectratio=true, width=2.5cm]
            {cc_by_nc_sa_40.eps}\\[1.2em]
    $endif$
    \justify
    $if(copyright)$
        \normalsize Copyright \textcopyright\space%
            $copyright$\\[1.2em]
    $endif$
    $if(license_text)$
        \normalsize $license_text$\\[1.2em]
    $endif$
    $if(license_attribution)$
        \normalsize {\bfseries Attribution}\textemdash%
             $license_attribution$\\[1.2em]
    $endif$
    $if(license_translations)$
        \normalsize {\bfseries Translations}\textemdash%
            $license_translations$\\[1.2em]
    $endif$
    $if(license_adaptations)$
        \normalsize {\bfseries Adaptations}\textemdash%
            $license_adaptations$\\[1.2em]
    $endif$
    $if(source)$
        \normalsize $source$\\[1.2em]
    $endif$
    \ifxetex
        \normalsize This PDF is generated using XeTeX %
            \the\eTeXversion\eTeXrevision-%
            \the\XeTeXversion\XeTeXrevision\space on \today.
    \else
        \normalsize This PDF is generated using pdfTeX %
            \the\eTeXversion\eTeXrevision-%
            \the\pdftexversion.\pdftexrevision\space on \today.
    \fi
\end{flushleft}
\pagebreak

% Start a new recto page
\cleardoublepage

%
% Table of contents
%
$if(toc)$
{
    \settocdepth{subsection}
    \cleardoublepage
    \begin{KeepFromToc} % Hide the ToC page entry in the ToC
        \tableofcontents
    \end{KeepFromToc}
    \pagebreak
    \cleardoublepage
}
$endif$



\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}

\hypertarget{conventions}{%
\section{Conventions Used}\label{conventions}}

The following typographical conventions are used in this document:

\begin{description}
%\tightlist
\item[\textnormal{\textit{Italic}}]\hfill \\
Indicates new terms, URLs, email addresses, filenames, and file
extensions.

\item[\textnormal{\texttt{Constant width}}]\hfill \\
Used for program listings as well as within paragraphs to refer to
program elements such as variable or function names, databases, data
types, environment variables, statements, and keywords.

\item[\textbf{\texttt{Constant width bold}}]\hfill \\
Shows commands or other text that should be typed literally by the user.

\item[\textnormal{\texttt{\textit{Constant width italic}}}]\hfill \\
Shows text that should be replaced with user-supplied values or by
values determined by context.
\end{description}



\pagebreak
\cleardoublepage



$if(lot)$
    \listoftables
$endif$

$if(lof)$
    \listoffigures
$endif$

% Longer preliminaries
% Foreword

%\acknowledgements

%\pagenumbering{arabic}
\mainmatter
$body$

\appendix

\backmatter

$if(natbib)$
    $if(bibliography)$
        $if(biblio-title)$
            $if(book-class)$
                \renewcommand\bibname{$biblio-title$}
            $else$
                \renewcommand\refname{$biblio-title$}
            $endif$
        $endif$
        \bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
    $endif$
$endif$

$if(biblatex)$
    \printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$
$endif$

%$for(include-after)$
%$include-after$
%$endfor$

%\printindex

\end{document}

% =============================================================================
% End document
% =============================================================================
